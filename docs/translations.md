# Translations in Ghost

This guide explains how Ghost's translation system works, including how translation strings are managed, extracted, and validated.

## Overview

Ghost uses [i18next](https://www.i18next.com/) for internationalization (i18n). The translation system supports **60+ languages** and covers multiple parts of the application:

- **ghost** - Core Ghost backend (emails, frontend helpers)
- **portal** - Member portal
- **signup-form** - Signup form widget
- **comments** - Comments widget
- **search** - Search functionality

All translation files are located in the `ghost/i18n` directory.

## File Structure

The translation system is organized as follows:

```
ghost/i18n/
├── locales/           # Translation files organized by locale
│   ├── en/            # English (source language)
│   │   ├── ghost.json
│   │   ├── portal.json
│   │   ├── signup-form.json
│   │   ├── comments.json
│   │   └── search.json
│   ├── fr/            # French translations
│   ├── es/            # Spanish translations
│   └── ...            # 60+ other locales
│   └── context.json   # Translation context/descriptions
├── lib/
│   └── i18n.js        # Main i18n library
├── test/
│   ├── i18n.lint.js   # Translation linter
│   └── i18n-ignores.json  # Linting exceptions
├── package.json
├── i18next-parser.config.js
└── generate-context.js
```

## Supported Locales

Ghost currently supports the following locales:

- Afrikaans (af)
- Albanian (sq)
- Arabic (ar)
- Bengali (bn)
- Bosnian (bs)
- Bulgarian (bg)
- Catalan (ca)
- Croatian (hr)
- Czech (cs)
- Danish (da)
- Dutch (nl)
- English (en) - *source language*
- Esperanto (eo)
- Estonian (et)
- Basque (eu)
- Finnish (fi)
- French (fr)
- German (de)
- German (Swiss) (de-CH)
- Greek (el)
- Hebrew (he)
- Hindi (hi)
- Hungarian (hu)
- Icelandic (is)
- Indonesian (id)
- Italian (it)
- Japanese (ja)
- Kazakh (kz)
- Korean (ko)
- Latvian (lv)
- Lithuanian (lt)
- Macedonian (mk)
- Malay (ms)
- Mongolian (mn)
- Nepali (ne)
- Norwegian Bokmål (nb)
- Norwegian Nynorsk (nn)
- Persian/Farsi (fa)
- Polish (pl)
- Portuguese (pt)
- Portuguese (Brazil) (pt-BR)
- Punjabi (pa)
- Romanian (ro)
- Russian (ru)
- Scottish Gaelic (gd)
- Serbian (sr)
- Serbian (Cyrillic) (sr-Cyrl)
- Sinhala (si)
- Slovak (sk)
- Slovenian (sl)
- Spanish (es)
- Swahili (sw)
- Swedish (sv)
- Tamil (ta)
- Thai (th)
- Turkish (tr)
- Ukrainian (uk)
- Urdu (ur)
- Uzbek (uz)
- Vietnamese (vi)
- Chinese (zh)
- Chinese (Traditional) (zh-Hant)

## Translation File Format

Each translation file is a JSON file with key-value pairs. The keys are the English source strings, and the values are the translations:

**English source (`en/ghost.json`):**
```json
{
    "Email": "Email",
    "Sign in": "Sign in",
    "Welcome to {siteTitle}!": "Welcome to {siteTitle}!"
}
```

**French translation (`fr/ghost.json`):**
```json
{
    "Email": "E-mail",
    "Sign in": "Se connecter",
    "Welcome to {siteTitle}!": "Bienvenue sur {siteTitle} !"
}
```

### Variables in Translations

Translations can contain variables wrapped in curly braces. These variables are replaced at runtime with actual values:

```json
{
    "Welcome to {siteTitle}!": "Welcome to {siteTitle}!",
    "By {authors}": "By {authors}",
    "Sent to {email}": "Sent to {email}"
}
```

The variable names must match exactly between the source English string and the translation.

## Translation Context

The `locales/context.json` file provides descriptions and context for translators. This helps translators understand where and how each string is used:

```json
{
    "Email": "A label for email address input",
    "Sign in": "A button to sign in",
    "Welcome to {siteTitle}!": "Popup when a member logs in"
}
```

This file is automatically generated and updated when running translation extraction scripts.

## How Translations Work

### 1. Using Translations in Code

Ghost uses i18next throughout the codebase. Here's how translations are used:

**In JavaScript:**
```javascript
const i18n = require('../i18n');
const t = i18n('en', 'ghost');

// Simple translation
t('Email'); // "Email"

// Translation with variables
t('Welcome to {siteTitle}!', {siteTitle: 'My Blog'}); // "Welcome to My Blog!"
```

**In Handlebars templates:**
```handlebars
{{t "Email"}}
{{t "Welcome to {siteTitle}!" siteTitle=@site.title}}
```

### 2. Extracting Translation Strings

When developers add new translatable strings to the code, they need to be extracted into the translation files. This is done using `i18next-parser`.

**Run extraction for all namespaces:**
```bash
cd ghost/i18n
yarn translate
```

This runs individual extraction commands for each namespace:
- `yarn translate:ghost` - Extracts from Ghost core
- `yarn translate:portal` - Extracts from Portal app
- `yarn translate:signup-form` - Extracts from Signup Form app
- `yarn translate:comments` - Extracts from Comments app
- `yarn translate:search` - Extracts from Search app

The extraction process:
1. Scans specified source files for translation keys
2. Updates all locale JSON files with new keys
3. Preserves existing translations
4. Generates updated `context.json`

### 3. Configuration

The extraction is configured in `i18next-parser.config.js`:

```javascript
module.exports = {
    locales: SUPPORTED_LOCALES,
    keySeparator: false,
    namespaceSeparator: false,
    defaultNamespace: process.env.NAMESPACE || 'translation',
    createOldCatalogs: false,
    indentation: 4,
    sort: true,
    failOnUpdate: process.env.CI,
    output: 'locales/$LOCALE/$NAMESPACE.json'
};
```

Key settings:
- **keySeparator: false** - Allows dots in translation keys
- **namespaceSeparator: false** - Allows colons in translation keys
- **sort: true** - Keeps keys alphabetically sorted
- **failOnUpdate: true in CI** - Prevents CI from passing if translations need updating

## Translation Validation

Ghost includes a custom linter to validate translations and ensure quality.

### Running the Linter

```bash
cd ghost/i18n
yarn lint:translations
```

### Validation Rules

The linter checks for several types of errors:

#### 1. Invalid Interpolations

Ensures curly braces are properly matched:

```json
// ❌ Error: Unclosed {
"Welcome to {siteTitle": "Welcome to {siteTitle"

// ✅ Correct
"Welcome to {siteTitle}": "Welcome to {siteTitle}"
```

#### 2. Unused Variables

Warns when a variable is defined in the source but not used in the translation:

```json
// English source
"Welcome to {siteTitle}!": "Welcome to {siteTitle}!"

// ❌ Error: Translation does not use variable "siteTitle"
"Welcome to {siteTitle}!": "Bienvenue !"

// ✅ Correct
"Welcome to {siteTitle}!": "Bienvenue sur {siteTitle} !"
```

#### 3. Undefined Variables

Errors when a translation uses a variable not present in the source:

```json
// English source
"Welcome!": "Welcome!"

// ❌ Error: Translation uses unknown variable "name"
"Welcome!": "Bienvenue {name} !"

// ✅ Correct
"Welcome!": "Bienvenue !"
```

### Ignoring Validation Errors

Sometimes validation errors are intentional (e.g., grammatical differences between languages). These can be ignored by adding them to `test/i18n-ignores.json`:

```json
{
    "overrides": {
        "ghost/i18n/no-unused-variables": [
            {
                "file": "fr/ghost.json",
                "key": "Some translation key",
                "comment": "French grammar doesn't require this variable"
            }
        ]
    }
}
```

You can also automatically ignore all errors (useful for bulk updates):

```bash
yarn lint:translations --fix --unsafe-ignore-all
```

## Development Workflow

### Adding New Translatable Strings

1. **Write code with translation calls:**
   ```javascript
   t('New feature title')
   t('Welcome {name}!', {name: userName})
   ```

2. **Extract translations:**
   ```bash
   cd ghost/i18n
   yarn translate
   ```

3. **Verify extraction:**
   - Check that new keys appear in `locales/en/*.json`
   - Verify other locales have empty values for new keys
   - Check `locales/context.json` was updated

4. **Run tests:**
   ```bash
   yarn test
   ```

5. **Commit changes:**
   Include both code changes and updated translation files in your commit.

### Updating Existing Translations

When modifying existing translation keys:

1. **Update the English source** in code
2. **Run extraction** to update all locale files
3. **Run linter** to catch validation errors:
   ```bash
   yarn lint:translations
   ```
4. **Fix or ignore** validation errors as appropriate

### Contributing Translations

To contribute translations for a new language or improve existing ones:

1. **Edit the appropriate locale file** in `ghost/i18n/locales/{locale}/`
2. **Use `context.json`** to understand the context of each string
3. **Preserve variables** - ensure all `{variable}` placeholders are included
4. **Run validation:**
   ```bash
   yarn lint:translations
   ```
5. **Test your translations** by running Ghost with that locale
6. **Submit a pull request** with your changes

## Fallback Behavior

When a translation is missing or empty, Ghost falls back as follows:

1. Try the requested locale (e.g., `fr`)
2. If missing, fall back to English (`en`)
3. If still missing, return the translation key itself

Norwegian (`no`) has special fallback behavior:
- Falls back to Norwegian Bokmål (`nb`) before English

## Testing Translations

### Manual Testing

To test a specific locale:

1. Set the locale in Ghost settings or via API
2. Navigate through the application
3. Verify translations appear correctly

### Automated Testing

The i18n package includes comprehensive tests:

```bash
cd ghost/i18n
yarn test
```

This runs:
- Unit tests for the i18n library
- Translation linting
- Coverage checks

## Best Practices

### For Developers

1. **Always use translation keys** - Never hardcode user-facing strings
2. **Keep keys as full sentences** - Avoid building sentences from fragments
3. **Use descriptive keys** - The key should be the full English text
4. **Run extraction regularly** - Don't let translation files get out of sync
5. **Provide context** - Add comments or update context.json for ambiguous strings

### For Translators

1. **Preserve variables** - All `{variable}` placeholders must be included
2. **Maintain formality** - Match the tone of the source language
3. **Check context** - Use `context.json` to understand usage
4. **Test in context** - If possible, see how the translation appears in the UI
5. **Ask questions** - If context is unclear, ask in the pull request

## Common Issues

### Translations Not Appearing

If translations aren't showing:

1. Check the locale is set correctly
2. Verify the translation file exists and is valid JSON
3. Ensure the key exactly matches the source
4. Check for empty translation values (will fall back to English)

### Validation Errors

If the linter reports errors:

1. Check for mismatched curly braces
2. Verify all variables from the source are used
3. Ensure no extra variables are added
4. Add to `i18n-ignores.json` if error is intentional

### Extraction Not Working

If translation extraction fails:

1. Verify you're in the `ghost/i18n` directory
2. Check the source file paths in `package.json` scripts
3. Ensure translation calls follow i18next conventions
4. Run with verbose output to see specific errors

## Related Files

- **`ghost/i18n/lib/i18n.js`** - Main i18n implementation (ghost/i18n/lib/i18n.js:92)
- **`ghost/i18n/package.json`** - Scripts and dependencies (ghost/i18n/package.json:17)
- **`ghost/i18n/i18next-parser.config.js`** - Extraction configuration (ghost/i18n/i18next-parser.config.js:6)
- **`ghost/i18n/test/i18n.lint.js`** - Translation validator (ghost/i18n/test/i18n.lint.js:1)

## Additional Resources

- [i18next Documentation](https://www.i18next.com/)
- [i18next-parser](https://github.com/i18next/i18next-parser)
- [Ghost Forum - Translations](https://forum.ghost.org/c/translations)
